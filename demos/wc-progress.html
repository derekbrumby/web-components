<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>&lt;wc-progress&gt; demo</title>
    <link rel="stylesheet" href="./demo-base.css" />
    <script type="module" src="../src/progress.js"></script>
    <style>
      .progress-preview {
        display: grid;
        gap: 1rem;
      }

      .progress-grid {
        display: grid;
        gap: 1.5rem;
      }

      .progress-actions {
        display: flex;
        gap: 0.75rem;
        align-items: center;
        flex-wrap: wrap;
      }

      .progress-themed {
        --progress-height: 1.5rem;
        --progress-background: rgba(15, 23, 42, 0.16);
        --progress-indicator-background: rgba(255, 255, 255, 0.85);
        --progress-indicator-foreground: linear-gradient(90deg, rgb(56 189 248), rgb(14 165 233));
        --progress-transition-duration: 520ms;
        --progress-radius: 9999px;
        --progress-width: 22rem;
        box-shadow: inset 0 0 0 1px rgba(14, 116, 144, 0.25);
      }

      .progress-themed::part(label) {
        margin-top: 0.5rem;
        font-size: 0.85rem;
        color: rgba(14, 116, 144, 0.85);
      }

      .progress-panel {
        display: grid;
        gap: 0.75rem;
      }

      .progress-state {
        font-family: var(--demo-mono-font);
        font-size: 0.85rem;
      }
    </style>
  </head>
  <body>
    <main>
      <section data-docs="wc-progress"></section>
      <section>
        <div class="example-grid two-column">
          <div class="example-card progress-grid">
            <h3>Task completion</h3>
            <p>
              The component automatically computes accessible labels, handles determinate and indeterminate states, and can be
              controlled from JavaScript.
            </p>
            <div class="progress-preview" data-code-example>
              <wc-progress id="progress-demo" value="13" max="100" label="Profile setup"></wc-progress>
              <p class="progress-state" id="progress-state">13 of 100 — 13% complete</p>
              <div class="progress-actions">
                <button type="button" id="progress-start">Start update</button>
                <button type="button" id="progress-complete">Complete instantly</button>
                <button type="button" id="progress-reset">Reset</button>
              </div>
            </div>
          </div>

          <div class="example-card progress-panel" data-code-example>
            <h3>Theming with CSS properties</h3>
            <p>
              Override the exposed custom properties to restyle the indicator without touching the internal markup.
            </p>
            <wc-progress class="progress-themed" value="66" max="120">
              <span slot="label">Quota usage — 66 of 120 GB</span>
            </wc-progress>
            <wc-progress class="progress-themed" value-text="Streaming..." label="Buffering" hidden></wc-progress>
            <div class="progress-actions">
              <button type="button" id="progress-indeterminate">Toggle buffering</button>
            </div>
          </div>
        </div>
      </section>
    </main>

    <script>
      const progressDemo = document.getElementById('progress-demo');
      const progressState = document.getElementById('progress-state');
      const progressStart = document.getElementById('progress-start');
      const progressComplete = document.getElementById('progress-complete');
      const progressReset = document.getElementById('progress-reset');
      const progressIndeterminate = document.getElementById('progress-indeterminate');
      const progressBuffer = document
        .querySelectorAll('wc-progress.progress-themed')
        .item(1);

      let animationFrame = 0;

      const formatState = (value, max) => {
        const percentage = Math.round((value / max) * 100);
        return `${value} of ${max} — ${percentage}% complete`;
      };

      const updateLabel = () => {
        if (!progressDemo || !progressState || progressDemo.value === null) return;
        progressState.textContent = formatState(progressDemo.value, progressDemo.max);
      };

      const animateProgress = () => {
        if (!progressDemo) return;
        const nextValue = Math.min(progressDemo.value + 5, progressDemo.max);
        progressDemo.value = nextValue;
        updateLabel();

        if (nextValue < progressDemo.max) {
          animationFrame = window.setTimeout(animateProgress, 480);
        }
      };

      progressStart?.addEventListener('click', () => {
        window.clearTimeout(animationFrame);
        animateProgress();
      });

      progressComplete?.addEventListener('click', () => {
        if (!progressDemo) return;
        window.clearTimeout(animationFrame);
        progressDemo.value = progressDemo.max;
        updateLabel();
      });

      progressReset?.addEventListener('click', () => {
        if (!progressDemo) return;
        window.clearTimeout(animationFrame);
        progressDemo.value = 13;
        updateLabel();
      });

      progressIndeterminate?.addEventListener('click', () => {
        if (!progressBuffer) return;
        if (progressBuffer.hasAttribute('hidden')) {
          progressBuffer.removeAttribute('hidden');
          progressBuffer.value = null;
        } else {
          progressBuffer.setAttribute('hidden', '');
        }
      });

      updateLabel();
    </script>
    
    <script type="module">
      import { renderComponentDocs } from './component-docs.js';
      renderComponentDocs('wc-progress');
    </script>
    <script type="module" src="./demo-code-blocks.js"></script>
  </body>
</html>
