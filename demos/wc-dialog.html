<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>&lt;wc-dialog&gt; demo</title>
    <link rel="stylesheet" href="./demo-base.css" />
    <script type="module" src="../src/dialog.js"></script>
  </head>
  <body>
    <main>
      <section>
        <header>
          <h2>&lt;wc-dialog&gt;</h2>
          <p>
            General-purpose dialogs that can run modally or as lightweight, non-modal panels. Manage focus, labelling,
            and styling entirely with slots and CSS properties.
          </p>
        </header>

        <div class="example-grid two-column">
          <div class="example-card">
            <h3>Profile editor (modal)</h3>
            <wc-dialog
              id="dialog-profile"
              style="
                --dialog-width: min(500px, 90vw);
                --dialog-background: rgba(248, 250, 252, 0.98);
                --dialog-overlay-background: rgba(15, 23, 42, 0.45);
                --dialog-shadow: 0 32px 64px -32px rgba(15, 23, 42, 0.5);
                --dialog-close-background: rgba(148, 163, 184, 0.25);
              "
            >
              <button slot="trigger">Edit profile</button>
              <span slot="title">Edit profile</span>
              <span slot="description">
                Make changes to your public details. Save the form when you're done.
              </span>
              <form class="dialog-form" id="dialog-profile-form">
                <label class="dialog-field">
                  <span class="dialog-label">Name</span>
                  <input
                    class="dialog-input"
                    type="text"
                    name="name"
                    value="Pedro Duarte"
                    autocomplete="name"
                  />
                </label>
                <label class="dialog-field">
                  <span class="dialog-label">Username</span>
                  <input
                    class="dialog-input"
                    type="text"
                    name="username"
                    value="@peduarte"
                    autocomplete="username"
                  />
                </label>
              </form>
              <div slot="footer" class="dialog-footer">
                <button type="button" class="ghost-button" data-dialog-close="true">Cancel</button>
                <button type="submit" form="dialog-profile-form">Save changes</button>
              </div>
            </wc-dialog>
            <pre class="log" id="dialog-profile-log">Dialog closed. Click “Edit profile” to open.</pre>
          </div>

          <div class="example-card">
            <h3>Inline inspector (non-modal)</h3>
            <wc-dialog
              id="dialog-inspector"
              modal="false"
              open
              style="
                --dialog-width: min(360px, 90vw);
                --dialog-padding: 1.25rem;
                --dialog-background: rgba(255, 255, 255, 0.96);
                --dialog-overlay-background: transparent;
                --dialog-shadow: 0 24px 48px -28px rgba(15, 23, 42, 0.35);
                --dialog-close-background: rgba(148, 163, 184, 0.25);
              "
            >
              <button slot="trigger" class="ghost-button">Toggle inspector</button>
              <span slot="title">Component inspector</span>
              <span slot="description">
                Non-modal dialogs keep the rest of the interface interactive.
              </span>
              <dl class="dialog-meta">
                <div>
                  <dt>Element</dt>
                  <dd>&lt;wc-avatar&gt;</dd>
                </div>
                <div>
                  <dt>Slots used</dt>
                  <dd class="dialog-pill-row">
                    <span class="dialog-pill">fallback</span>
                    <span class="dialog-pill">default</span>
                    <span class="dialog-pill">trigger</span>
                  </dd>
                </div>
                <div>
                  <dt>Recent action</dt>
                  <dd>Avatar updated 2 minutes ago</dd>
                </div>
              </dl>
              <div slot="footer" class="dialog-footer">
                <button type="button" class="ghost-button" data-dialog-close="true">Close panel</button>
              </div>
            </wc-dialog>
            <p>
              Because <code>modal="false"</code> is set, the dialog stays visible while you continue interacting with
              the rest of the page.
            </p>
          </div>
        </div>
      </section>
    </main>

    <script>
      const dialogProfile = document.getElementById('dialog-profile');
      const dialogProfileForm = document.getElementById('dialog-profile-form');
      const dialogProfileLog = document.getElementById('dialog-profile-log');
      let profileSaveTimer = 0;
      if (dialogProfile && dialogProfileForm instanceof HTMLFormElement && dialogProfileLog) {
        const profileClosedText = 'Dialog closed. Click “Edit profile” to open.';
        const profileOpenText = 'Dialog open. Update fields and save.';
        const updateProfileLog = () => {
          const desired = dialogProfile.hasAttribute('open') ? profileOpenText : profileClosedText;
          if (dialogProfile.hasAttribute('open')) {
            dialogProfileLog.textContent = desired;
            return;
          }
          const current = dialogProfileLog.textContent || '';
          if (current === profileClosedText || current === profileOpenText) {
            dialogProfileLog.textContent = desired;
          }
        };
        dialogProfileLog.textContent = profileClosedText;
        updateProfileLog();
        const observer = new MutationObserver(updateProfileLog);
        observer.observe(dialogProfile, { attributes: true, attributeFilter: ['open'] });

        dialogProfileForm.addEventListener('submit', (event) => {
          event.preventDefault();
          if (profileSaveTimer) {
            window.clearTimeout(profileSaveTimer);
            profileSaveTimer = 0;
          }
          dialogProfileLog.textContent = 'Saving changes…';
          const formData = new FormData(dialogProfileForm);
          const nameValue = String(formData.get('name') || '').trim();
          const usernameValue = String(formData.get('username') || '').trim();
          profileSaveTimer = window.setTimeout(() => {
            const summary = nameValue || 'Profile';
            const usernameSuffix = usernameValue ? ` (${usernameValue})` : '';
            dialogProfileLog.textContent = `Saved ${summary}${usernameSuffix}.`;
            if (typeof dialogProfile.hide === 'function') {
              dialogProfile.hide();
            } else {
              dialogProfile.removeAttribute('open');
            }
            profileSaveTimer = 0;
          }, 700);
        });
      }

      document.addEventListener('click', (event) => {
        const target = event.target;
        if (!(target instanceof HTMLElement)) return;
        if (target.dataset.dialogClose === 'true') {
          const host = target.closest('wc-dialog');
          if (!host) return;
          event.preventDefault();
          if (host.id === 'dialog-profile' && dialogProfileLog) {
            if (profileSaveTimer) {
              window.clearTimeout(profileSaveTimer);
              profileSaveTimer = 0;
            }
            dialogProfileLog.textContent = 'Changes discarded.';
          }
          if (typeof host.hide === 'function') {
            host.hide();
          } else {
            host.removeAttribute('open');
          }
        }
      });
    </script>
  </body>
</html>
