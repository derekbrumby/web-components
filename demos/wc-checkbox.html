<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>&lt;wc-checkbox&gt; demo</title>
    <link rel="stylesheet" href="./demo-base.css" />
    <script type="module" src="../src/checkbox.js"></script>
  </head>
  <body>
    <main>
      <section>
        <div class="example-grid two-column">
          <div class="example-card">
            <h3>Consent agreement</h3>
            <form id="checkbox-consent" class="checkbox-stack" onsubmit="event.preventDefault();">
              <wc-checkbox id="checkbox-consent-control" name="terms" value="accepted" required>
                Accept terms and conditions.
              </wc-checkbox>
              <p class="checkbox-inline-note">
                Required before continuing. Toggle the checkbox to see how form submission reflects the current state.
              </p>
              <button type="submit">Continue</button>
            </form>
            <pre class="log" id="checkbox-consent-log">Awaiting interaction…</pre>
          </div>

          <div class="example-card">
            <h3>Bulk selection with indeterminate state</h3>
            <div class="checkbox-stack">
              <wc-checkbox id="checkbox-master" indeterminate>
                Notify me about workspace updates
              </wc-checkbox>
              <div class="checkbox-list" id="checkbox-items">
                <wc-checkbox class="checkbox-item" value="product" checked>Product announcements</wc-checkbox>
                <wc-checkbox class="checkbox-item" value="security" checked>Security advisories</wc-checkbox>
                <wc-checkbox class="checkbox-item" value="news">Community highlights</wc-checkbox>
              </div>
            </div>
            <pre class="log" id="checkbox-selection-log">All options pending…</pre>
          </div>
        </div>
      </section>
    </main>

    <script>
      const checkboxConsentForm = document.getElementById('checkbox-consent');
      const checkboxConsentControl = document.getElementById('checkbox-consent-control');
      const checkboxConsentLog = document.getElementById('checkbox-consent-log');

      if (checkboxConsentForm && checkboxConsentControl && checkboxConsentLog) {
        checkboxConsentControl.addEventListener('change', () => {
          checkboxConsentLog.textContent = checkboxConsentControl.checked
            ? 'Consent granted. The form can now be submitted.'
            : 'Consent withdrawn. Submission is blocked until accepted again.';
        });

        checkboxConsentForm.addEventListener('submit', (event) => {
          event.preventDefault();
          if (!checkboxConsentControl.checked) {
            checkboxConsentLog.textContent = 'Cannot submit: terms must be accepted first.';
            return;
          }
          const formData = new FormData(checkboxConsentForm);
          checkboxConsentLog.textContent = `Submitted with terms=${formData.get('terms')}.`;
        });
      }

      const checkboxMaster = document.getElementById('checkbox-master');
      const checkboxItemsContainer = document.getElementById('checkbox-items');
      const checkboxSelectionLog = document.getElementById('checkbox-selection-log');

      if (checkboxMaster && checkboxItemsContainer && checkboxSelectionLog) {
        const checkboxItems = Array.from(
          checkboxItemsContainer.querySelectorAll('wc-checkbox.checkbox-item')
        );

        const updateMasterState = () => {
          const checkedCount = checkboxItems.filter((item) => item.checked).length;
          if (checkedCount === 0) {
            checkboxMaster.checked = false;
            checkboxMaster.indeterminate = false;
          } else if (checkedCount === checkboxItems.length) {
            checkboxMaster.checked = true;
            checkboxMaster.indeterminate = false;
          } else {
            checkboxMaster.checked = false;
            checkboxMaster.indeterminate = true;
          }
        };

        const updateSelectionLog = () => {
          const selected = checkboxItems
            .filter((item) => item.checked)
            .map((item) => (item.textContent || '').trim())
            .filter(Boolean);
          const state = checkboxMaster.indeterminate
            ? 'indeterminate'
            : checkboxMaster.checked
              ? 'checked'
              : 'unchecked';
          checkboxSelectionLog.textContent =
            selected.length > 0
              ? `Master is ${state}. Selected: ${selected.join(', ')}.`
              : `Master is ${state}. No notifications selected.`;
        };

        checkboxMaster.addEventListener('change', () => {
          const shouldCheck = checkboxMaster.checked;
          checkboxMaster.indeterminate = false;
          checkboxItems.forEach((item) => {
            item.checked = shouldCheck;
          });
          updateSelectionLog();
        });

        checkboxItems.forEach((item) => {
          item.addEventListener('change', () => {
            updateMasterState();
            updateSelectionLog();
          });
        });

        updateMasterState();
        updateSelectionLog();
      }
    </script>
  </body>
</html>
