<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Web Components Demo</title>
    <script type="module" src="./src/otp-field.js"></script>
    <script type="module" src="./src/accordion.js"></script>
    <script type="module" src="./src/alert-dialog.js"></script>
    <script type="module" src="./src/dialog.js"></script>
    <script type="module" src="./src/aspect-ratio.js"></script>
    <script type="module" src="./src/avatar.js"></script>
    <style>
      :root {
        color-scheme: light dark;
      }

      body {
        margin: 0;
        font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: linear-gradient(135deg, #f9fafb, #eef2ff);
        color: #0f172a;
      }

      main {
        max-width: 960px;
        margin: 0 auto;
        padding: 3rem 1.5rem 4rem;
        display: grid;
        gap: 3rem;
      }

      h1 {
        font-size: clamp(2.5rem, 5vw, 3.5rem);
        margin: 0;
        font-weight: 700;
      }

      section {
        background: rgba(255, 255, 255, 0.88);
        backdrop-filter: blur(8px);
        border-radius: 1.25rem;
        border: 1px solid rgba(148, 163, 184, 0.25);
        box-shadow: 0 40px 80px -40px rgba(15, 23, 42, 0.35);
        padding: 2rem;
        display: grid;
        gap: 1.5rem;
      }

      section header {
        display: grid;
        gap: 0.5rem;
      }

      section header h2 {
        margin: 0;
        font-size: clamp(1.75rem, 3vw, 2.25rem);
      }

      section header p {
        margin: 0;
        color: #475569;
        line-height: 1.6;
      }

      form {
        display: grid;
        gap: 1rem;
      }

      .example-card {
        display: grid;
        gap: 1.25rem;
      }

      .log {
        background: rgba(15, 23, 42, 0.05);
        border-radius: 0.75rem;
        padding: 1rem;
        font-family: "JetBrains Mono", "Fira Code", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        font-size: 0.875rem;
        color: #0f172a;
        overflow-x: auto;
        white-space: pre-wrap;
      }

      .example-grid {
        display: grid;
        gap: 1.5rem;
      }

      .avatar-row {
        display: flex;
        flex-wrap: wrap;
        gap: 1.25rem;
        align-items: center;
      }

      .avatar-row wc-avatar {
        flex: 0 0 auto;
        box-shadow: 0 20px 40px -28px rgba(15, 23, 42, 0.45);
      }

      .avatar-caption {
        margin: 0;
        color: #475569;
        line-height: 1.6;
      }

      .avatar-callout {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 1rem;
        background: rgba(99, 102, 241, 0.08);
        border-radius: 1rem;
        padding: 1rem 1.25rem;
      }

      .avatar-callout > div {
        min-inline-size: 200px;
        flex: 1 1 160px;
      }

      .avatar-callout strong {
        display: block;
        font-weight: 600;
        color: #312e81;
      }

      .avatar-callout p {
        margin: 0.35rem 0 0;
        color: #4338ca;
        line-height: 1.6;
      }

      @media (min-width: 900px) {
        .example-grid.two-column {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }
      }

      button {
        border: none;
        border-radius: 999px;
        background: #4f46e5;
        color: #ffffff;
        font-weight: 600;
        padding: 0.75rem 1.75rem;
        cursor: pointer;
        transition: transform 150ms ease, box-shadow 150ms ease;
      }

      button:hover {
        transform: translateY(-1px);
        box-shadow: 0 14px 30px -18px rgba(79, 70, 229, 0.8);
      }

      button:active {
        transform: translateY(1px);
      }

      .ghost-button {
        background: rgba(148, 163, 184, 0.18);
        color: #0f172a;
        box-shadow: none;
      }

      .ghost-button:hover {
        box-shadow: none;
        background: rgba(148, 163, 184, 0.28);
      }

      .danger-button {
        background: #ef4444;
        box-shadow: 0 14px 30px -18px rgba(239, 68, 68, 0.8);
      }

      .danger-button:hover {
        box-shadow: 0 16px 32px -18px rgba(239, 68, 68, 0.8);
      }

      .button-soft {
        background: rgba(56, 189, 248, 0.16);
        color: #0369a1;
      }

      .button-soft:hover {
        box-shadow: none;
        background: rgba(56, 189, 248, 0.24);
      }

      .dialog-check {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        margin-top: 0.75rem;
        font-size: 0.95rem;
        color: #0f172a;
      }

      .dialog-check input {
        width: 1.15rem;
        height: 1.15rem;
        accent-color: #38bdf8;
      }

      .dialog-form {
        display: grid;
        gap: 1rem;
        margin: 0;
      }

      .dialog-field {
        display: grid;
        gap: 0.35rem;
      }

      .dialog-label {
        font-weight: 600;
        color: #312e81;
      }

      .dialog-input {
        border: 1px solid rgba(148, 163, 184, 0.45);
        border-radius: 0.65rem;
        padding: 0.65rem 0.75rem;
        font: inherit;
        background: rgba(255, 255, 255, 0.85);
        color: #0f172a;
        transition: border-color 150ms ease, box-shadow 150ms ease;
      }

      .dialog-input:focus {
        outline: none;
        border-color: #6366f1;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
      }

      .dialog-footer {
        display: flex;
        justify-content: flex-end;
        gap: 0.75rem;
        margin-top: 1rem;
      }

      .dialog-meta {
        display: grid;
        gap: 0.75rem;
        margin: 0;
      }

      .dialog-meta dt {
        font-size: 0.75rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: #64748b;
        margin: 0;
      }

      .dialog-meta dd {
        margin: 0.25rem 0 0;
        font-weight: 600;
        color: #1e293b;
      }

      .dialog-pill-row {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        align-items: center;
      }

      .dialog-pill {
        background: rgba(56, 189, 248, 0.16);
        color: #0369a1;
        padding: 0.35rem 0.65rem;
        border-radius: 999px;
        font-size: 0.75rem;
        letter-spacing: 0.03em;
      }
    </style>
  </head>
  <body>
    <main>
      <header>
        <h1>Web Component Playground</h1>
        <p>Drop-in friendly, dependency-free elements ready for CDN delivery.</p>
      </header>

      <section>
        <header>
          <h2>&lt;wc-avatar&gt;</h2>
          <p>Display users with graceful image loading, delayed fallbacks, and fully themable initials.</p>
        </header>

        <div class="example-card">
          <h3>Design crew roll call</h3>
          <div class="avatar-row">
            <wc-avatar
              src="https://images.unsplash.com/photo-1492633423870-43d1cd2775eb?w=128&h=128&dpr=2&q=80"
              alt="Colm Tuite"
              initials="CT"
              fallback-delay="600"
              style="
                --avatar-background: rgba(15, 23, 42, 0.08);
                --avatar-fallback-background: #ffffff;
                --avatar-fallback-color: #4338ca;
              "
            ></wc-avatar>
            <wc-avatar
              src="https://images.unsplash.com/photo-1511485977113-f34c92461ad9?w=128&h=128&dpr=2&q=80"
              alt="Pedro Duarte"
              initials="PD"
              fallback-delay="600"
              loading="lazy"
              style="
                --avatar-background: rgba(15, 23, 42, 0.08);
                --avatar-fallback-background: #ffffff;
                --avatar-fallback-color: #4338ca;
              "
            ></wc-avatar>
            <wc-avatar
              alt="Polly Doe"
              initials="PD"
              style="
                --avatar-fallback-background: #1e1b4b;
                --avatar-fallback-color: #ede9fe;
              "
            ></wc-avatar>
          </div>
          <p class="avatar-caption">
            Each avatar waits 600&nbsp;ms before revealing its fallback while the image loads, reducing content flicker
            for fast connections.
          </p>
        </div>

        <div class="example-card">
          <h3>Custom fallback content</h3>
          <div class="avatar-callout">
            <wc-avatar
              alt="Lina Rivers"
              size="64px"
              style="
                --avatar-radius: 1rem;
                --avatar-background: rgba(15, 23, 42, 0.1);
                --avatar-fallback-background: rgba(99, 102, 241, 0.12);
                --avatar-fallback-color: #312e81;
              "
            >
              <span style="font-weight: 700; letter-spacing: 0.08em;">LR</span>
            </wc-avatar>
            <div>
              <strong>Slot anything inside.</strong>
              <p>
                Provide branded initials, icons, or status badges and the component keeps them centered, sized, and
                accessible.
              </p>
            </div>
          </div>
        </div>
      </section>

      <section>
        <header>
          <h2>&lt;wc-aspect-ratio&gt;</h2>
          <p>Keep media, embeds, and previews locked to a precise ratio without extra wrapper markup.</p>
        </header>

        <div class="example-grid two-column">
          <div class="example-card">
            <h3>Wide hero image (16&nbsp;/&nbsp;9)</h3>
            <wc-aspect-ratio
              ratio="16/9"
              style="
                max-width: 320px;
                --aspect-ratio-border-radius: 1rem;
                --aspect-ratio-shadow: 0 24px 48px -32px rgba(15, 23, 42, 0.65);
              "
            >
              <img
                src="https://images.unsplash.com/photo-1535025183041-0991a977e25b?w=640&dpr=2&q=80"
                alt="Landscape photograph by Tobias Tullius"
                style="border-radius: inherit; box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.12);"
              />
            </wc-aspect-ratio>
            <p>
              Images, videos, and other media automatically stretch to fill the frame while preserving the
              aspect ratio using CSS custom properties.
            </p>
          </div>

          <div class="example-card">
            <h3>Square embed (1&nbsp;/&nbsp;1)</h3>
            <wc-aspect-ratio
              ratio="1"
              style="
                --aspect-ratio-background: radial-gradient(circle at 25% 25%, #22d3ee, #0ea5e9);
                --aspect-ratio-border-radius: 1.25rem;
                --aspect-ratio-content-align: center;
                --aspect-ratio-content-justify: center;
                color: white;
                font-weight: 600;
                letter-spacing: 0.08em;
                text-transform: uppercase;
              "
            >
              <div style="text-align: center;">
                Responsive embed
              </div>
            </wc-aspect-ratio>
            <p>
              Nest any HTML content—maps, charts, or previews—and keep it centered within a consistent
              square footprint.
            </p>
          </div>
        </div>
      </section>

      <section>
        <header>
          <h2>&lt;wc-otp-field&gt;</h2>
          <p>
            A form-associated one-time-password input that manages focus, validation, and submissions.
            Customize appearance using CSS properties or <code>::part</code> selectors.
          </p>
        </header>

        <div class="example-grid two-column">
          <div class="example-card">
            <h3>Classic six-digit numeric code</h3>
            <form id="otp-demo" onsubmit="event.preventDefault();">
              <wc-otp-field
                name="otp"
                length="6"
                validation-type="numeric"
                placeholder="•"
                auto-submit
                autocomplete="one-time-code"
                style="
                  --otp-gap: 0.75rem;
                  --otp-input-size: 56px;
                  --otp-font-size: 20px;
                  --otp-radius: 14px;
                  --otp-bg: rgba(255,255,255,0.9);
                  --otp-border: 1px solid rgba(148, 163, 184, 0.4);
                  --otp-border-focus: 2px solid #4f46e5;
                  --otp-shadow-focus: 0 0 0 6px rgba(79,70,229,0.15);
                "
              ></wc-otp-field>
              <button type="submit">Submit</button>
            </form>
            <pre class="log" id="otp-log">Waiting for input…</pre>
          </div>

          <div class="example-card">
            <h3>Vertical alphanumeric with masking</h3>
            <wc-otp-field
              id="otp-advanced"
              length="8"
              validation-type="alphanumeric"
              orientation="vertical"
              type="password"
              placeholder="✶"
              dir="ltr"
              style="
                --otp-gap: 0.35rem;
                --otp-input-size: 44px;
                --otp-bg: rgba(15, 23, 42, 0.85);
                --otp-color: #f8fafc;
                --otp-border: 1px solid rgba(148, 163, 184, 0.5);
                --otp-border-focus: 2px solid #f97316;
                --otp-shadow-focus: 0 0 0 4px rgba(249, 115, 22, 0.35);
              "
            ></wc-otp-field>
            <pre class="log" id="otp-advanced-log">Type to see updates…</pre>
          </div>
        </div>
      </section>

      <section>
        <header>
          <h2>&lt;wc-dialog&gt;</h2>
          <p>
            General-purpose dialogs that can run modally or as lightweight, non-modal panels. Manage focus,
            labelling, and styling entirely with slots and CSS properties.
          </p>
        </header>

        <div class="example-grid two-column">
          <div class="example-card">
            <h3>Profile editor (modal)</h3>
            <wc-dialog
              id="dialog-profile"
              style="
                --dialog-width: min(500px, 90vw);
                --dialog-background: rgba(248, 250, 252, 0.98);
                --dialog-overlay-background: rgba(15, 23, 42, 0.45);
                --dialog-shadow: 0 32px 64px -32px rgba(15, 23, 42, 0.5);
                --dialog-close-background: rgba(148, 163, 184, 0.25);
              "
            >
              <button slot="trigger">Edit profile</button>
              <span slot="title">Edit profile</span>
              <span slot="description">
                Make changes to your public details. Save the form when you're done.
              </span>
              <form class="dialog-form" id="dialog-profile-form">
                <label class="dialog-field">
                  <span class="dialog-label">Name</span>
                  <input
                    class="dialog-input"
                    type="text"
                    name="name"
                    value="Pedro Duarte"
                    autocomplete="name"
                  />
                </label>
                <label class="dialog-field">
                  <span class="dialog-label">Username</span>
                  <input
                    class="dialog-input"
                    type="text"
                    name="username"
                    value="@peduarte"
                    autocomplete="username"
                  />
                </label>
              </form>
              <div slot="footer" class="dialog-footer">
                <button type="button" class="ghost-button" data-dialog-close="true">Cancel</button>
                <button type="submit" form="dialog-profile-form">Save changes</button>
              </div>
            </wc-dialog>
            <pre class="log" id="dialog-profile-log">Dialog closed. Click “Edit profile” to open.</pre>
          </div>

          <div class="example-card">
            <h3>Inline inspector (non-modal)</h3>
            <wc-dialog
              id="dialog-inspector"
              modal="false"
              open
              style="
                --dialog-width: min(360px, 90vw);
                --dialog-padding: 1.25rem;
                --dialog-background: rgba(255, 255, 255, 0.96);
                --dialog-overlay-background: transparent;
                --dialog-shadow: 0 24px 48px -28px rgba(15, 23, 42, 0.35);
                --dialog-close-background: rgba(148, 163, 184, 0.25);
              "
            >
              <button slot="trigger" class="ghost-button">Toggle inspector</button>
              <span slot="title">Component inspector</span>
              <span slot="description">
                Non-modal dialogs keep the rest of the interface interactive.
              </span>
              <dl class="dialog-meta">
                <div>
                  <dt>Element</dt>
                  <dd>&lt;wc-avatar&gt;</dd>
                </div>
                <div>
                  <dt>Slots used</dt>
                  <dd class="dialog-pill-row">
                    <span class="dialog-pill">fallback</span>
                    <span class="dialog-pill">default</span>
                    <span class="dialog-pill">trigger</span>
                  </dd>
                </div>
                <div>
                  <dt>Recent action</dt>
                  <dd>Avatar updated 2 minutes ago</dd>
                </div>
              </dl>
              <div slot="footer" class="dialog-footer">
                <button type="button" class="ghost-button" data-dialog-close="true">Close panel</button>
              </div>
            </wc-dialog>
            <p>
              Because <code>modal="false"</code> is set, the dialog stays visible while you continue interacting
              with the rest of the page.
            </p>
          </div>
        </div>
      </section>

      <section>
        <header>
          <h2>&lt;wc-alert-dialog&gt;</h2>
          <p>
            Modal confirmation dialogs with focus trapping, accessible labelling, and customizable styling hooks.
            Use slots for triggers, titles, descriptions, and action buttons.
          </p>
        </header>

        <div class="example-grid two-column">
          <div class="example-card">
            <h3>Destructive confirmation</h3>
            <wc-alert-dialog id="alert-dialog-destructive">
              <button slot="trigger" class="danger-button">Delete account</button>
              <span slot="title">Delete this account?</span>
              <span slot="description">
                This action is permanent. All saved projects, data exports, and automation hooks will be removed.
              </span>
              <div>
                <ul>
                  <li>Billing will be cancelled immediately.</li>
                  <li>Team members will lose workspace access.</li>
                  <li>You can contact support within 7 days to undo this action.</li>
                </ul>
              </div>
              <button slot="cancel" class="ghost-button">Cancel</button>
              <button slot="action" class="danger-button">Yes, delete it</button>
            </wc-alert-dialog>
            <pre class="log" id="alert-dialog-destructive-log">Choose an action to view emitted events.</pre>
          </div>

          <div class="example-card">
            <h3>Async confirmation with custom theming</h3>
            <wc-alert-dialog
              id="alert-dialog-async"
              style="
                --alert-dialog-overlay-background: rgba(15, 23, 42, 0.55);
                --alert-dialog-background: #0f172a;
                --alert-dialog-color: #f8fafc;
                --alert-dialog-description-color: rgba(226, 232, 240, 0.88);
                --alert-dialog-body-margin: 1rem 0 1.75rem;
                --alert-dialog-action-background: #38bdf8;
                --alert-dialog-button-radius: 0.75rem;
              "
            >
              <button slot="trigger" class="button-soft">Archive project</button>
              <span slot="title">Archive this project?</span>
              <span slot="description">
                Archiving hides the project from active views. You can restore it at any time within the next 30 days.
              </span>
              <div>
                <label class="dialog-check">
                  <input type="checkbox" id="alert-dialog-async-keep" checked />
                  Keep analytics data available
                </label>
              </div>
              <button slot="cancel" class="ghost-button">Go back</button>
              <button slot="action" class="button-soft">Archive</button>
            </wc-alert-dialog>
            <pre class="log" id="alert-dialog-async-log">Archive to simulate an asynchronous workflow.</pre>
          </div>
        </div>
      </section>

      <section>
        <header>
          <h2>&lt;wc-accordion&gt;</h2>
          <p>
            Accessible accordion primitives with keyboard support, horizontal or vertical layouts, and multi-open configurations.
          </p>
        </header>

        <div class="example-grid">
          <div class="example-card">
            <h3>Single item open at a time</h3>
            <wc-accordion id="accordion-single" type="single" collapsible>
              <wc-accordion-item value="item-1">
                <span slot="trigger">Is it accessible?</span>
                <p slot="content">
                  Yes. It adheres to the WAI-ARIA accordion pattern and exposes keyboard navigation.
                </p>
              </wc-accordion-item>
              <wc-accordion-item value="item-2">
                <span slot="trigger">Can I restyle it?</span>
                <p slot="content">
                  Absolutely. Use CSS custom properties like <code>--accordion-trigger-background</code> or target parts such as
                  <code>::part(trigger)</code> and <code>::part(panel-inner)</code>.
                </p>
              </wc-accordion-item>
              <wc-accordion-item value="item-3">
                <span slot="trigger">Will it collapse?</span>
                <p slot="content">
                  When <code>collapsible</code> is set, users can close the active item, leaving all sections collapsed.
                </p>
              </wc-accordion-item>
            </wc-accordion>
            <pre class="log" id="accordion-single-log">Interact with the accordion to see state updates.</pre>
          </div>

          <div class="example-card">
            <h3>Multiple expansion with horizontal layout</h3>
            <wc-accordion
              id="accordion-multi"
              type="multiple"
              orientation="horizontal"
              values="item-a,item-c"
              style="
                --accordion-gap: 1rem;
                --accordion-surface: transparent;
              "
            >
              <wc-accordion-item value="item-a" heading-level="4" style="--accordion-trigger-background: rgba(14, 165, 233, 0.12);">
                <span slot="trigger">Design tokens</span>
                <div slot="content">
                  <ul>
                    <li>--accordion-radius</li>
                    <li>--accordion-trigger-padding</li>
                    <li>--accordion-transition-duration</li>
                  </ul>
                </div>
              </wc-accordion-item>
              <wc-accordion-item value="item-b" heading-level="4" style="--accordion-trigger-background: rgba(249, 115, 22, 0.12);">
                <span slot="trigger">Animation</span>
                <p slot="content">
                  Panels animate using height transitions that respect <code>--accordion-transition-duration</code> and
                  <code>--accordion-transition-easing</code>.
                </p>
              </wc-accordion-item>
              <wc-accordion-item value="item-c" heading-level="4" style="--accordion-trigger-background: rgba(34, 197, 94, 0.12);">
                <span slot="trigger">Accessibility</span>
                <p slot="content">
                  Built-in keyboard handling supports arrow keys, Home/End navigation, and respects disabled items.
                </p>
              </wc-accordion-item>
            </wc-accordion>
            <pre class="log" id="accordion-multi-log">Open and close multiple panels to inspect emitted values.</pre>
          </div>
        </div>
      </section>
    </main>

    <script>
      const otpForm = document.getElementById('otp-demo');
      const otpLog = document.getElementById('otp-log');
      const otpAdvanced = document.getElementById('otp-advanced');
      const otpAdvancedLog = document.getElementById('otp-advanced-log');

      if (otpForm && otpLog) {
        otpForm.addEventListener('submit', (event) => {
          const formData = new FormData(event.target);
          otpLog.textContent = `Submitted code: ${formData.get('otp') || '(empty)'}`;
        });
        otpForm.querySelector('wc-otp-field')?.addEventListener('valuechange', (event) => {
          const value = event.detail?.value || '';
          otpLog.textContent = `Typing: ${value}`;
        });
      }

      if (otpAdvanced && otpAdvancedLog) {
        otpAdvanced.addEventListener('valuechange', (event) => {
          const value = event.detail?.value || '';
          otpAdvancedLog.textContent = `Current value: ${value}`;
        });
      }

      const accordionSingle = document.getElementById('accordion-single');
      const accordionSingleLog = document.getElementById('accordion-single-log');
      if (accordionSingle && accordionSingleLog) {
        accordionSingle.addEventListener('change', (event) => {
          accordionSingleLog.textContent = `Open value: ${event.detail?.value || 'none'}`;
        });
      }

      const accordionMulti = document.getElementById('accordion-multi');
      const accordionMultiLog = document.getElementById('accordion-multi-log');
      if (accordionMulti && accordionMultiLog) {
        accordionMulti.addEventListener('change', (event) => {
          const values = event.detail?.values || [];
          accordionMultiLog.textContent = `Open values: ${values.join(', ') || 'none'}`;
        });
      }

      const alertDestructive = document.getElementById('alert-dialog-destructive');
      const alertDestructiveLog = document.getElementById('alert-dialog-destructive-log');
      if (alertDestructive && alertDestructiveLog) {
        alertDestructive.addEventListener('cancel', () => {
          alertDestructiveLog.textContent = 'Deletion cancelled.';
        });
        alertDestructive.addEventListener('confirm', () => {
          alertDestructiveLog.textContent = 'Account deletion confirmed.';
        });
      }

      const alertAsync = document.getElementById('alert-dialog-async');
      const alertAsyncLog = document.getElementById('alert-dialog-async-log');
      if (alertAsync && alertAsyncLog) {
        const actionButton = alertAsync.querySelector('[slot="action"]');
        const defaultActionLabel =
          actionButton instanceof HTMLButtonElement ? actionButton.textContent || 'Archive' : 'Archive';
        let alertAsyncTimer = 0;

        const resetActionButton = () => {
          if (actionButton instanceof HTMLButtonElement) {
            actionButton.disabled = false;
            actionButton.textContent = defaultActionLabel;
          }
        };

        alertAsync.addEventListener('cancel', () => {
          if (alertAsyncTimer) {
            clearTimeout(alertAsyncTimer);
            alertAsyncTimer = 0;
          }
          resetActionButton();
          alertAsyncLog.textContent = 'Archive cancelled.';
        });

        alertAsync.addEventListener('confirm', (event) => {
          event.preventDefault();
          if (actionButton instanceof HTMLButtonElement) {
            actionButton.disabled = true;
            actionButton.textContent = 'Archiving…';
          }
          alertAsyncLog.textContent = 'Archiving project…';

          const keepAnalyticsCheckbox = document.getElementById('alert-dialog-async-keep');

          alertAsyncTimer = window.setTimeout(() => {
            const keepAnalytics =
              keepAnalyticsCheckbox instanceof HTMLInputElement && keepAnalyticsCheckbox.checked;
            resetActionButton();
            alertAsyncLog.textContent = keepAnalytics
              ? 'Project archived with analytics preserved.'
              : 'Project archived. Analytics purged.';
            if (typeof alertAsync.hide === 'function') {
              alertAsync.hide();
            } else {
              alertAsync.removeAttribute('open');
            }
            alertAsyncTimer = 0;
          }, 1200);
        });
      }

      const dialogProfile = document.getElementById('dialog-profile');
      const dialogProfileForm = document.getElementById('dialog-profile-form');
      const dialogProfileLog = document.getElementById('dialog-profile-log');
      let profileSaveTimer = 0;
      if (dialogProfile && dialogProfileForm instanceof HTMLFormElement && dialogProfileLog) {
        const profileClosedText = 'Dialog closed. Click “Edit profile” to open.';
        const profileOpenText = 'Dialog open. Update fields and save.';
        const updateProfileLog = () => {
          const desired = dialogProfile.hasAttribute('open') ? profileOpenText : profileClosedText;
          if (dialogProfile.hasAttribute('open')) {
            dialogProfileLog.textContent = desired;
            return;
          }
          const current = dialogProfileLog.textContent || '';
          if (current === profileClosedText || current === profileOpenText) {
            dialogProfileLog.textContent = desired;
          }
        };
        dialogProfileLog.textContent = profileClosedText;
        updateProfileLog();
        const observer = new MutationObserver(updateProfileLog);
        observer.observe(dialogProfile, { attributes: true, attributeFilter: ['open'] });

        dialogProfileForm.addEventListener('submit', (event) => {
          event.preventDefault();
          if (profileSaveTimer) {
            window.clearTimeout(profileSaveTimer);
            profileSaveTimer = 0;
          }
          dialogProfileLog.textContent = 'Saving changes…';
          const formData = new FormData(dialogProfileForm);
          const nameValue = String(formData.get('name') || '').trim();
          const usernameValue = String(formData.get('username') || '').trim();
          profileSaveTimer = window.setTimeout(() => {
            const summary = nameValue || 'Profile';
            const usernameSuffix = usernameValue ? ` (${usernameValue})` : '';
            dialogProfileLog.textContent = `Saved ${summary}${usernameSuffix}.`;
            if (typeof dialogProfile.hide === 'function') {
              dialogProfile.hide();
            } else {
              dialogProfile.removeAttribute('open');
            }
            profileSaveTimer = 0;
          }, 700);
        });
      }

      document.addEventListener('click', (event) => {
        const target = event.target;
        if (!(target instanceof HTMLElement)) return;
        if (target.dataset.dialogClose === 'true') {
          const host = target.closest('wc-dialog');
          if (!host) return;
          event.preventDefault();
          if (host.id === 'dialog-profile' && dialogProfileLog) {
            if (profileSaveTimer) {
              window.clearTimeout(profileSaveTimer);
              profileSaveTimer = 0;
            }
            dialogProfileLog.textContent = 'Changes discarded.';
          }
          if (typeof host.hide === 'function') {
            host.hide();
          } else {
            host.removeAttribute('open');
          }
        }
      });
    </script>
  </body>
</html>
